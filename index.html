<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8" />
		<meta app_box="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

		<title>Neurosizer: Neurointervention Device Sizer</title>

		<!-- Required Stylesheets -->
		<link
				  type="text/css"
      rel="stylesheet"
      href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css"
      />
		<link
      type="text/css"
      rel="stylesheet"
      href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"
      />

		<!-- Type Ahead Library -->
		<link 
      href="https://unpkg.com/vue-bootstrap-typeahead/dist/VueBootstrapTypeahead.css" 
      rel="stylesheet"
      />

		<!-- Load polyfills to support older browsers -->
		<script src="https://polyfill.io/v3/polyfill.min.js?features=es2015%2CIntersectionObserver"></script>

		<!-- Required scripts -->
		<script src="https://unpkg.com/vue@latest/dist/vue.js"></script>
		<script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>

		<!-- Type Ahead Library -->
		<script src="https://unpkg.com/vue-bootstrap-typeahead"></script>

		<!-- Device Library -->
		<script src="deviceList.js"></script>


	</head>
	<body>
		<!-- Our application root element -->


		<div id="app">
			<b-navbar toggleable="lg" type="dark" variant="info">
				<b-navbar-brand href="#">NeuroSizer</b-navbar-brand>

				<b-navbar-toggle target="nav-collapse"></b-navbar-toggle>

				<b-collapse id="nav-collapse" is-nav>
					<b-navbar-nav>
					</b-navbar-nav>

					<!-- Right aligned nav items -->
					<b-navbar-nav class="ml-auto">
						<b-nav-item right href="#">Settings</b-nav-item>

						<b-nav-item-dropdown right>
							<!-- Using 'button-content' slot -->

							<template #button-content>
								Help
							</template>
							<b-dropdown-item href="#">About</b-dropdown-item>
						</b-nav-item-dropdown>
					</b-navbar-nav>
				</b-collapse>
			</b-navbar>


			<b-container>

				<h3></h3>
				<h3>Select devices</h3>

				<b-form-group
			horizontal
			:label-cols="3"
			label="Larger/outer device name"
   >    
   <vue-bootstrap-typeahead
   :data="devices"
   :serializer="item => item.name"
   @hit= "updateGuide($event); updateSizer()"
   />

				</b-form-group>

				<b-form-group
   horizontal
   :label-cols="3"
   label="Intermediate device name"
   >    
   <vue-bootstrap-typeahead
   :data="devices"
   :serializer="item => item.name"
   @hit="updateIntermediate($event); updateSizer()"
   />
				</b-form-group>


				<b-form-group
   horizontal
   :label-cols="3"
   label="Smaller/inner device 1"
   >    
   <vue-bootstrap-typeahead
   :data="devices"
   :serializer="item => item.name"
   @hit="updateMicro1($event); updateSizer()"
   />
				</b-form-group>

				<b-form-group
   horizontal
   :label-cols="3"
   label="Smaller/inner device 2"
   >    
   <vue-bootstrap-typeahead
   :data="devices"
   :serializer="item => item.name"
   @hit="updateMicro2($event); updateSizer()"
   />
				</b-form-group>

				<h3>Results</h3>
				<div id = "result"></div>

			</b-container>
		</div>

		<script>

var guide = null;
var intermediate = null;
var micro1 = null;
//micro1.max_od = 0;
var micro2 = null;


window.app = new Vue({
	components: {
		VueBootstrapTypeahead
	},
	el: '#app',
	data: {
		app_box: '',
		devices:  deviceList,
		selectedDeviceOuter: null,
		selectedDeviceInner: null
	},
	methods:{

		updateGuide: function(e){
			guide = e;
		},
		updateIntermediate: function(e){
			intermediate = e;
		},
		updateMicro1: function(e){
			micro1 = e;
		},

		updateMicro2: function(e){
			micro2 = e;
		},


		updateSizer: function(){

			var text = "Everything is fine.";
      			var additional = "";			

			// Calculate guide/intermediate catheters

			var smallestOuter = intermediate;

			if (intermediate == null) {
				smallestOuter = guide;
			}

			if (smallestOuter == null) {
				return;
			}

			additional =  "Smallest outer: " + smallestOuter.min_id + ". " ;


			if (intermediate != null && guide != null) {

				if (intermediate.max_od > guide.min_id) {

					text = "The intermediate does not fit in the guide. ";
				}
			}

			// Calculate microdevices

			var totalMicro = 0;

			if (micro1 != null) {
				totalMicro = totalMicro + micro1.max_od;
			}

			if (micro2 != null) {
				totalMicro = totalMicro + micro2.max_od;
			}

			additional = additional + "Micro devices total size " + totalMicro + ". " ;


			if (totalMicro > smallestOuter.min_id)
			{
				if (text == "Everything is fine.") {
					text = "";
				}
				text = text + "The micro devices do not fit.";

			}


			document.getElementById("result").innerHTML = text + "\n" + additional;

		}

	}
})
		</script>


	</body>
</html>
